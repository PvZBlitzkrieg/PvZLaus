# 这是什么  
这是一个使用 **[结绳](http://tiecode.qiplat.com/)** 编程重置还原原版 **[PvZ](http://www.popcap.com)** (植物大战僵尸)的项目.目前正在构建框架,很多内容不完善,所以单纯想玩的已经可以撤退了......文件只有[代码部分](源代码/),其他的资源部分没有上传,源码使用[AGPL协议](LICENSE)  
## 目前实现的功能
1.存档读档,但并非原版的存档格式,路径在/storage/emulated/0/.pvz/user.dat,支持多账户&账户切换,但未编写操作窗口  
2.加载界面,选择器界面,游戏主场景.所有地图的格子分割  
3.前六个植物,前九个僵尸,冒险模式出怪系统  
4.豌豆,寒冰豌豆  
5.贴图动作资源资源实时读取,加载  
6.冷却阳光种植系统,RGBFilter,透明度,区域绘制,Matrix&Affine矩阵变换  
7.动作播放,粒子特效文件暂时无法完全识别,所以粒子特效是代码实现的  
## 目前已知的[BUG](https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BA%8F%E9%94%99%E8%AF%AF)  
1.僵尸位置频闪  
2.卡顿导致的僵尸静止  
3.一些耗内存的操作还没来得及优化  
## 说明  
1.游戏资源全部为原版资源,裁剪,抠图,上色等操作全部在游戏内进行  
# 怎么运行  
[结绳](http://tiecode.qiplat.com/)是一个很小众的软件(或许吧)  
1.找到[最新版的结绳](http://tiecode.qiplat.com/download)([v4.6](https://www.123912.com/s/ZaCKVv-trPJH)),下载安装  
2.将完整的工程文件夹(PvZ_Laus)复制到 **/sdcard/Tiecode/Projects/** 目录  
3.编译运行  
4.直接编译是不会把其他资源打包进去的,要把 **[初始代码.t](源代码/初始代码.t)** 中的 **@附加资源(../assets)** 这一行取消注释  
不想编译的话直接下编译好的版本就可以了➡[t.me/xborks](https://t.me/xborks)  
# 其他  
本人的b站是[@㔔㪳](https://space.bilibili.com/9944455),YouTube[@Xborks](https://www.youtube.com/@xborks)  
## 代码说明  
### [初始代码.t](源代码/初始代码.t)  
#### 启动窗口  
顾名思义,主Activity.实现资源/权限检查,解压资源以及权限申请操作  
#### 非启动窗口  
唯二的Activity,初始化游戏,更新游戏的最重要的Activity  
start()方法中的新线程具有每10ms更新游戏的功能,游戏停摆19%是这个线程崩了  
##### 绘制  
在绘制时调用,80%的BUG是这里出的  
#### 窗口管理器
游戏管理器,负责绘制,更新,存取信息,你甚至可以将这个类移植到电脑端运行  
##### 初始化
顾名思义,初始化操作  
##### 绘制
里面是绘制屏幕上99%内容的代码,包括画僵尸,植物等  
#### Update
更新函数,更新各种互动,游戏内容,10ms被调用一次  
### [物体.t](源代码/物体.t)
里面是游戏画面中具有重复性的物体的类  
#### Zombie
僵尸  
#### Plant
植物  
#### Proj(Projectile)
子弹  
#### Tracle
临时动画,如头,胳膊  
#### Coin
可交互物品,如金币银币,阳光,礼盒,获胜植物卡,钱袋  
#### Particle
粒子特效动画,并不是识别原文件的  
#### userdata
用户数据  
### [资源.t](源代码/资源.t)
里面实现了各种游戏资源,具体如下.  
#### Anim
动画类  
这可以说是 **非常重要** 的一个类,里面实现了动画的播放.使用方式如下:  
动画有多个轨道组成  
##### static Anim 创建动画(名称,管理器)  
创建一个动画,名称即为compiled/reanim文件夹中的文件名(不含后缀)  
##### Anim 播放动画(名称,是否单次播放)  
播放动画,名称为轨道名.PvZ的动画中一部分"anim"开头轨道专门标记动画区间,可以在Adobe Animation中找那些全灰的轨道  
##### Anim 强制显示(名称,值,预设定)  
名称为String[] 轨道名称数组,值为是否显示,0显示 -1不显示,预设定代表是否要将其他轨道设置为相反的值  
##### Anim 过渡从(帧,时间)  
从当前帧过渡到参数中的 *帧*,消耗时间为参数中的时间,帧与时间为一次函数关系  
##### Anim 代理(名称,动画,变换属性,是否使用原动画)  
将其中一个轨道更改为你给出的动画,*名称*是轨道名,POS 变换属性为对此动画的变换,是否使用原动画代表是否将该轨原先的变换应用  
#### XMLR
XML读取器  
#### 判定矩形
用于点击判定.初始化需要传入四个点的坐标,为该四边形的四个点.注意这个四边形可以不是矩形.四点应按顺序,四边形应为凸四边形  
##### 判定(点)
使用面积法判断点是否在该四边形内.
## 注意事项  
1.参见AGPL协议  
2.这个项目目前很不完善,但已经初见端倪  
3.游戏会很卡,但我已经很尽力了,至少我使用了接近半年时间(2025.3-2025.7)去优化,并且多次更换了渲染引擎,效果都不大明显,使用电脑模拟器会比较流畅
## F&Q  
F:为什么加载速度这么慢?  
A:在[虚拟机](https://www.google.com/search?q=%E8%99%9A%E6%8B%9F%E6%9C%BA)中运行,速度会很快。  
F:游戏无故崩溃/重启,运行时手机/虚拟机突然重启  
A:报错日志在/sdcard/.pvz/pvz/properties/log.cat,没报错的话我也没办法了  
F:声音呢  
A:还没做,尽请期待  
## 关于结绳  
这是一个中文编程软件,它的原理是将其源码文件(Tiecode,.t)编译为java文件,在编译为apk所以理论上语法与java基本相同,只不过中文化了.这个项目完全可以稍加修改成为[Android Studio](https://developer.android.com/studio)项目,但我懒得这样做了  
